---
title: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¿ƒã‚’èª­ã‚€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ŒForesightJSã€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["TypeScript", "JavaScript", "ForesightJS", "Next.js", "React.js"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

# ForesightJSã§ãƒ¦ãƒ¼ã‚¶ãƒ¼èˆˆå‘³ã‚’ãƒã‚¦ã‚¹ã‹ã‚‰äºˆæ¸¬ã—ã€æœ€é©ãªãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã‚’è¡Œã† 

ForesightJSã¨ã„ã†é¢ç™½ãã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
å¿ƒã‚’èª­ã‚“ã§ãã‚Œã‚‹JSãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
ã¨ã„ã†ã®ã¯å†—è«‡ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¦ã‚¹ã‚„ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ã‚¿ãƒƒãƒã®å‹•ãã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èˆˆå‘³ã‚’äºˆæ¸¬ã—ã€æœ€é©ãªãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã‚’è¡Œã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

## ç²¾åº¦

å®Ÿéš›ã®ãƒ‡ãƒãƒƒã‚°ã§è¦‹ã‚‹äºˆæ¸¬ç²¾åº¦
å…¬å¼ã‚µã‚¤ãƒˆã§ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è»Œé“äºˆæ¸¬ãŒå¯è¦–åŒ–ã•ã‚Œã¾ã™ï¼š

```TypeScript
ForesightManager.initialize({
  debug: true, // è»Œé“ãŒèµ¤ã„ç·šã§è¡¨ç¤ºã•ã‚Œã‚‹
  trajectoryPredictionTime: 120, // 120mså…ˆã‚’äºˆæ¸¬
  positionHistorySize: 5 // éå»5ç‚¹ã®å±¥æ­´ã‚’ä½¿ç”¨
})
```

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¤œè¨¼ï¼š300msã®æ“¬ä¼¼é…å»¶ãƒ†ã‚¹ãƒˆ
å…¬å¼ãƒ‡ãƒ¢ã§ã¯æ„å›³çš„ã«300msã®é…å»¶ã‚’è¨­ã‘ã¦ã€å®Ÿéš›ã®ã‚µãƒ¼ãƒãƒ¼å¿œç­”ã‚’å†ç¾ã—ã¦ã„ã¾ã™ã€‚
å¾“æ¥ã®ãƒ›ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ï¼š

ãƒ›ãƒãƒ¼æ¤œçŸ¥ â†’ ãƒ•ã‚§ãƒƒãƒé–‹å§‹ â†’ 300mså¾…æ©Ÿ â†’ è¡¨ç¤º
ç·æ™‚é–“ï¼š300ms + Î±

ForesightJSï¼š

è»Œé“äºˆæ¸¬ï¼ˆ120mså‰ï¼‰ â†’ ãƒ•ã‚§ãƒƒãƒé–‹å§‹ â†’ ãƒ›ãƒãƒ¼æ™‚ã«ã¯æ—¢ã«180msãƒ•ã‚§ãƒƒãƒæ¸ˆã¿
ç·æ™‚é–“ï¼š120ms + Î±

**çµæœï¼šä½“æ„Ÿé€Ÿåº¦ãŒç´„60%å‘ä¸Š**

# ã€å®Ÿè£…ã—ã¦ã¿ãŸã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¿ƒã‚’èª­ã‚€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ŒForesightJSã€ãŒãƒ¤ãƒã™ããŸä»¶

## ã€Œãªã‚“ã§ã“ã‚“ãªã«é…ã„ã®ï¼Ÿã€ã‚’è§£æ±ºã—ã¦ãã‚ŒãŸç¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

ã¿ãªã•ã‚“ã€ã“ã‚“ãªçµŒé¨“ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

- ã€ŒNext.jsã®ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒã€ç„¡é§„ã«å¤šã™ãã¦é‡ã„...ã€
- ã€Œãƒ›ãƒãƒ¼ã—ã¦ã‹ã‚‰ãƒ•ã‚§ãƒƒãƒé–‹å§‹ã£ã¦ã€é…ããªã„ï¼Ÿã€
- ã€Œã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã“ã¨ã€å®Œå…¨ã«å¿˜ã‚Œã¦ãŸğŸ˜‡ã€

ãã‚“ãªé–‹ç™ºè€…ã‚ã‚‹ã‚ã‚‹ã‚’ä¸€æ°—ã«è§£æ±ºã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¦‹ã¤ã‘ãŸã®ã§ã€å®Ÿéš›ã«è§¦ã£ã¦ã¿ã¾ã—ãŸã€‚

**ForesightJS** â€” ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ãƒã‚¸ã§ãƒ¤ãƒã„ã§ã™ã€‚

## ğŸ¯ ä½•ãŒãƒ¤ãƒã„ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¿ƒãŒèª­ã‚ã¡ã‚ƒã†

ForesightJSã¯ã€**ãƒã‚¦ã‚¹ã®å‹•ãã‚’è§£æã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¬¡ã®è¡Œå‹•ã‚’äºˆæ¸¬**ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

ã¤ã¾ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹å‰ã«ã€Œã‚ã€ã“ã®äººã“ã®ãƒœã‚¿ãƒ³æŠ¼ã—ãã†ã€ã£ã¦åˆ†ã‹ã£ã¡ã‚ƒã†ã‚“ã§ã™ã€‚

### å®Ÿéš›ã«è©¦ã—ã¦ã¿ãŸçµæœãŒã“ã¡ã‚‰

```javascript
import { ForesightManager } from "foresightjs"

// 3è¡Œã§è¨­å®šå®Œäº†
ForesightManager.initialize({
  debug: true, // ã“ã‚ŒONã«ã™ã‚‹ã¨è»Œé“ãŒè¦‹ãˆã¦é¢ç™½ã„
  trajectoryPredictionTime: 80
})

const productCard = document.getElementById("product-card")
ForesightManager.instance.register({
  element: productCard,
  callback: () => {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ãƒ¼ãƒ‰ã«å‘ã‹ã£ã¦ãƒã‚¦ã‚¹å‹•ã‹ã—ãŸç¬é–“ã«å®Ÿè¡Œ
    console.log("å•†å“è©³ç´°ã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒé–‹å§‹ï¼")
    prefetchProductDetails(productId)
  }
})
```

## ğŸš€ å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼šECã‚µã‚¤ãƒˆã§è©¦ã—ã¦ã¿ãŸ

### Beforeï¼šå¾“æ¥ã®ãƒ›ãƒãƒ¼ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ
- ãƒ›ãƒãƒ¼ã—ã¦ã‹ã‚‰ãƒ•ã‚§ãƒƒãƒé–‹å§‹
- 200ms ã®ç„¡é§„ãªå¾…æ©Ÿæ™‚é–“
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èšŠå¸³ã®å¤–

### Afterï¼šForesightJSå°å…¥å¾Œ
- ãƒã‚¦ã‚¹ãŒã‚«ãƒ¼ãƒ‰ã«å‘ã‹ã£ãŸç¬é–“ã«ãƒ•ã‚§ãƒƒãƒé–‹å§‹
- **ä½“æ„Ÿé€Ÿåº¦ãŒåŠ‡çš„ã«æ”¹å–„**
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚äºˆæ¸¬ãŒåŠ¹ã

```javascript
// å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã§ã®å®Ÿè£…ä¾‹
const setupProductCards = () => {
  document.querySelectorAll('.product-card').forEach(card => {
    const productId = card.dataset.productId
    
    ForesightManager.instance.register({
      element: card,
      callback: () => {
        // å•†å“è©³ç´°ã®ç”»åƒã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å…ˆèª­ã¿
        prefetchProductImages(productId)
        prefetchProductReviews(productId)
      },
      hitSlop: 15 // ã‚«ãƒ¼ãƒ‰ã®å‘¨å›²15pxã§ã‚‚åå¿œ
    })
  })
}
```

## ğŸ“Š æ•°å€¤ã§è¦‹ã‚‹æ”¹å–„åŠ¹æœ

å®Ÿéš›ã«Next.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è¨ˆæ¸¬ã—ã¦ã¿ã¾ã—ãŸï¼š

| æŒ‡æ¨™ | Before | After | æ”¹å–„ç‡ |
|------|--------|-------|--------|
| ãƒšãƒ¼ã‚¸é·ç§»é€Ÿåº¦ | 350ms | 180ms | **48%å‘ä¸Š** |
| ç„¡é§„ãªãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ | 1.59MB | 0.3MB | **81%å‰Šæ¸›** |
| ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ | âŒ | âœ… | **âˆ%æ”¹å–„** |

## ğŸ›  å®Ÿè£…ãŒè¶…ç°¡å˜ã™ãã‚‹ä»¶

### 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ1ç§’ï¼‰
```bash
npm install js.foresight
```

### 2. è¨­å®šï¼ˆ3è¡Œï¼‰
```javascript
import { ForesightManager } from "foresightjs"

ForesightManager.initialize({
  debug: process.env.NODE_ENV === 'development'
})
```

### 3. ä½¿ç”¨ï¼ˆè¦ç´ ã”ã¨ã«æ•°è¡Œï¼‰
```javascript
// ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚«ãƒ¼ãƒ‰ã®ä¾‹
const { unregister } = ForesightManager.instance.register({
  element: articleCard,
  callback: () => {
    // è¨˜äº‹æœ¬æ–‡ã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ
    router.prefetch(`/articles/${articleId}`)
  }
})
```

## ğŸ¨ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãŒè¶…é¢ç™½ã„

`debug: true` ã«ã™ã‚‹ã¨ã€**ãƒã‚¦ã‚¹ã®è»Œé“äºˆæ¸¬ãŒå¯è¦–åŒ–**ã•ã‚Œã¾ã™ã€‚

ã“ã‚ŒãŒã‚ã¡ã‚ƒãã¡ã‚ƒé¢ç™½ãã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‹•ããŒæ‰‹ã«å–ã‚‹ã‚ˆã†ã«åˆ†ã‹ã‚Šã¾ã™ã€‚ãƒãƒ¼ãƒ å†…ã§ã¿ã‚“ãªã§è¦‹ã¦ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ãŸğŸ˜„

## ğŸ”¥ ã“ã‚“ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ãˆãã†

### âœ… ECã‚µã‚¤ãƒˆ
- å•†å“ã‚«ãƒ¼ãƒ‰ãƒ›ãƒãƒ¼æ™‚ã®è©³ç´°ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ
- ã‚«ãƒ¼ãƒˆè¿½åŠ ãƒœã‚¿ãƒ³ã®äºˆæ¸¬

### âœ… ãƒ–ãƒ­ã‚°ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µã‚¤ãƒˆ
- è¨˜äº‹ã‚«ãƒ¼ãƒ‰ã®æœ¬æ–‡ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ
- é–¢é€£è¨˜äº‹ã®å…ˆèª­ã¿

### âœ… SPA
- ãƒ«ãƒ¼ãƒˆé·ç§»ã®æœ€é©åŒ–
- ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ã®å…ˆèª­ã¿

### âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®äºˆæ¸¬èª­ã¿è¾¼ã¿
- ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã®é«˜é€ŸåŒ–

## ğŸ’¡ å®Ÿè£…ä¾‹

### ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œã‚‚å¿˜ã‚Œãšã«
```javascript
const { isTouchDevice, unregister } = ForesightManager.instance.register({
  element: myElement,
  callback: () => {
    if (isTouchDevice) {
      // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ç”¨ã®åˆ¥ãƒ­ã‚¸ãƒƒã‚¯
      handleTouchOptimization()
    } else {
      // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ã®ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒ
      prefetchContent()
    }
  }
})
```

### React/Next.jsã¨ã®çµ„ã¿åˆã‚ã›
```javascript
useEffect(() => {
  const { unregister } = ForesightManager.instance.register({
    element: buttonRef.current,
    callback: () => {
      // Next.jsã®router.prefetch()ã¨çµ„ã¿åˆã‚ã›
      router.prefetch('/target-page')
    }
  })
  
  return unregister // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚å¿˜ã‚Œãšã«
}, [])
```
## ä½™è«‡: ForesightJS ã®ä»•çµ„ã¿

ç·šå½¢å¤–æŒ¿æ³•ã«ã‚ˆã‚‹è»Œé“äºˆæ¸¬
ForesightJSã¯ç·šå½¢å¤–æŒ¿æ³•ï¼ˆLinear Extrapolationï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¦ã‚¹ã®å°†æ¥ä½ç½®ã‚’äºˆæ¸¬ã—ã¦ã„ã¾ã™ã€‚ç°¡å˜ã«è¨€ã†ã¨ã€éå»ã®å‹•ãã‹ã‚‰æœªæ¥ã‚’è¨ˆç®—ã§å°ãå‡ºã™ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚

ã‚ˆã‚Šå…·ä½“çš„ã«å®Ÿè£…ä¾‹ã¨ã¨ã‚‚ã«èª¬æ˜ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜

```typescript
// 1. å±¥æ­´è¿½è·¡ï¼šéå»ã®ãƒã‚¦ã‚¹ä½ç½®ã‚’è¨˜éŒ²
const mouseHistory = [
  { x: 100, y: 200, timestamp: 1000 },
  { x: 120, y: 180, timestamp: 1016 },
  { x: 140, y: 160, timestamp: 1032 }
]

// 2. é€Ÿåº¦è¨ˆç®—ï¼šæœ€å¤ã¨æœ€æ–°ã®ç‚¹ã‹ã‚‰å¹³å‡é€Ÿåº¦ã‚’ç®—å‡º
const velocity = {
  x: (newest.x - oldest.x) / (newest.timestamp - oldest.timestamp),
  y: (newest.y - oldest.y) / (newest.timestamp - oldest.timestamp)
}

// 3. å¤–æŒ¿ï¼šç¾åœ¨ä½ç½®ã‹ã‚‰æœªæ¥ä½ç½®ã‚’äºˆæ¸¬
const predictedPoint = {
  x: currentX + velocity.x * trajectoryPredictionTime,
  y: currentY + velocity.y * trajectoryPredictionTime
}
```

äºˆæ¸¬ã—ãŸè»Œé“ãŒè¦ç´ ã¨äº¤å·®ã™ã‚‹ã‹ã®åˆ¤å®šã«ã¯ã€Liang-Barsky line clipping algorithmã¨ã„ã†åŠ¹ç‡çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```typescript
// å®Ÿéš›ã®äº¤å·®åˆ¤å®šã®æµã‚Œ
function lineSegmentIntersectsRect(currentPoint, predictedPoint, elementRect) {
  // 1. ç·šåˆ†ã®å®šç¾©ï¼ˆç¾åœ¨ä½ç½® â†’ äºˆæ¸¬ä½ç½®ï¼‰
  const lineSegment = { start: currentPoint, end: predictedPoint }
  
  // 2. å››è§’å½¢ã®å®šç¾©ï¼ˆè¦ç´  + hitSlop ã®æ‹¡å¼µé ˜åŸŸï¼‰
  const expandedRect = {
    left: elementRect.left - hitSlop.left,
    top: elementRect.top - hitSlop.top,
    right: elementRect.right + hitSlop.right,
    bottom: elementRect.bottom + hitSlop.bottom
  }
  
  // 3. å„è¾ºã¨ã®äº¤å·®ã‚’ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ãƒ†ã‚¹ãƒˆã§åˆ¤å®š
  // 4. äº¤å·®ãŒã‚ã‚Œã°true
}


```
